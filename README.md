# WSO2_Linux_Security_Assignment


## Operating Systems used
1. Ubuntu
2. Kali Linux

## IP Addresses 
1. Web Server - 192.168.1.230
2. Victim     - 192.168.1.233
3. Hacker     - 192.168.1.20


## 1. Apply controls to protect from DDOS attacks

### Installing Apache Web Server

```
sudo apt update
sudo apt install apache2
```

### After installing I went ahead and uploaded a sample website to the /var/www folder and created a new config file in /etc/apache3/sites-available/

```
nano /etc/apache3/sites-available/gci.conf
sudo a2ensite gci.conf
systemctl reload apache2
```

###### After following the above steps you should have a working simple website.

### Afterwards I ran a SYN Flood Attack by spoofing my IP to the victims IP address. This is the command that I executed

```
hping3 -a 192.168.1.233 192.168.1.230 -S --flood -V -p 80
```
###### 192.168.1.233 is the victim's IP and 192.168.1.230 is the web server's IP address.

###### Initiating SYN Flood attack (Spoofed IP)
![image](https://user-images.githubusercontent.com/75664650/130322699-d6d7c32d-9233-4b9f-8226-2fbefc2c2cf6.png)

###### Tcp Dump (Hacker)

![image](https://user-images.githubusercontent.com/75664650/130322740-2f7bef27-9b62-4c9a-8b9d-468460716e4a.png)

###### TCP Dump (Web Server)

![image](https://user-images.githubusercontent.com/75664650/130322758-41931a42-86b4-4337-9347-53461d25be5b.png)

###### TCP Dump (Victim)

![image](https://user-images.githubusercontent.com/75664650/130322786-4a15d731-8a13-4d61-befb-caaa0f2d5d26.png)

### After running the SYN Flood Attack the load time of the wepbage was extremely slow and sometimes it was not even accessible. 

### To avoid SYN Flood Attacks I went ahead and configured iptables. This is the command I executed

```
sudo iptables -I INPUT 1 -p tcp --syn -m hashlimit --hashlimit 1/s --hashlimit-burst 3 --hashlimit-mode srcip --hashlimit-srcmask 32 --hashlimit-name synattack -j ACCEPT
sudo iptables -I INPUT 2  -p tcp --syn -j DROP
```

###### After adding the above iptables I went ahead and initiated the SYN Flood attack on my Kali Machine. At that point the victim was unable to access the server but the other were able to access it with no issues. 

###### Web server can be accessed via a different machine

![Untitled](https://user-images.githubusercontent.com/75664650/130328959-f5b96ae9-d1a6-468a-91a1-1bbeba5f4dde.png)


###### Web server cannot be accessed through the victim

![image](https://user-images.githubusercontent.com/75664650/130328964-c9375c78-b3c4-4e2d-81dd-4e2f43f051b9.png)


### Also I enabled iptable logging so we can log the source ip and destination ip when the set rule is triggered.

```
sudo iptables -I INPUT 1 -p tcp --syn -m hashlimit --hashlimit 1/s --hashlimit-burst 3 --hashlimit-mode srcip --hashlimit-srcmask 32 --hashlimit-name synattack -j LOG --log-prefix '** SYN ATTACK DETECTED **'
```

###### Iptable log files are generated by the kernel and it can be accessed via the kernel log file. So I wanted to save the iptable logs to a seperate file. I first edited the rsyslog.conf file located in /etc and added the followng line to it

```
kern.warning /var/log/iptables.log
```

###### Then I restarted rsyslog service using the following command

```
service rsyslog restart
```

###### Screenshot of the iptable logs 

![image](https://user-images.githubusercontent.com/75664650/130329002-64f83391-47d0-4d31-8e2b-490d992b82df.png)

## 2. CHROOT

### Creating users 

```
adduser alice
adduser bob
adduser john
```

### Creating groups

```
groupadd Admin
groupadd Finance
groupadd Sales
```

### Assigning users to groups

```
usermod -G Admin alice
usermod -G Admin,Sales bob
usermod -G Sales john
```

### Creating the directory 'wso2' and ‘jail’

```
mkdir wso2
mkdir jail
```

### Copying libraries to jail directory

```
mkdir bin lib lib64
cp /bin/bash bin/
cp /lib/x86_64-linux-gnu/libtinfo.so.6  /lib/x86_64-linux-gnu/libdl.so.2 /lib/x86_64-linux-gnu/libc.so.6 lib/
cp /lib64/ld-linux-x86-64.so.2 lib64/
cp /lib/x86_64-linux-gnu/libselinux.so.1 /lib/x86_64-linux-gnu/libc.so.6 /lib/x86_64-linux-gnu/libpcre2-8.so.0 /lib/x86_64-linux-gnu/libdl.so.2 /lib/x86_64-linux-gnu/libpthread.so.0 lib/
cp /lib64/ld-linux-x86-64.so.2 lib64/
```

### Configuring sshd_config file

###### First I went ahead and installed open-ssh server on my Ubuntu machine then I went ahead and commented Subsytem line and added a new line with the following

```
Susbsystem sftp internal-sftp
```

## 3. SELINUX

### Before installing SELinux I had to uninstall AppArmor from Ubuntu to avoid conflicts

```
sudo systemctl stop apparmor
sudo apt-get remove apparmor -y
sudo reboot
```


### Installing SELINUX

```
sudo apt install policycoreutils selinux-utils selinux-basics
```

### Activating SELINUX

```
sudo selinux-activate
sudo reboot
```


### Setting SELinux operating mode to enforcing

```
sudo selinux-config-enforcing
sudo reboot
```

### Enabling binary module ""mozilla_manage_all_user_content"" as default protected daemon by target policy

```
setsebool mozilla_manage_all_user_conten on
```

## 4. Advance File Permissions

### First I logged into alice and created a executable file with the following

```
#!/bin/bash

echo "Hello World";
while true
do
sleep 1
done
```

###### The I executed the following

```
chmod +x executablefile
sudo cp executablefile /usr/local/bin
sudo chmod u+s /usr/local/bin/executablefile
```

![image](https://user-images.githubusercontent.com/75664650/130659827-76138052-721b-4e5d-b9ed-6f0a159b7951.png)

![image](https://user-images.githubusercontent.com/75664650/130659857-1dbebcda-ecd4-48da-abb5-9385c49d69a6.png)


### I ran the following so only the root user can run ping command

```
chmod -R 700 /usr/bin/ping
```

![image](https://user-images.githubusercontent.com/75664650/130660330-97dd9c28-ca97-4830-b268-bb2790a0b4d9.png)

![image](https://user-images.githubusercontent.com/75664650/130660365-5e36200e-c31e-4142-9539-ff7e8cd4c97e.png)

### I ran the following to allow the ping command to user Alice without setting execute permission to others

```
chown -R Alice:Admin /usr/bin/ping
chown 
```

![image](https://user-images.githubusercontent.com/75664650/130661121-de38bef2-c682-4ec4-8816-7419f147cd13.png)

![image](https://user-images.githubusercontent.com/75664650/130661429-2f39afb8-7229-49f7-9611-c1f74e967aae.png)

![image](https://user-images.githubusercontent.com/75664650/130661462-d47cf135-caf3-4158-9667-545c7081f5ac.png)


## 5. Access Control with sudo

### Adding permission to user John so that he can only view /var/log/auth.log,/etc/shadow files

```
setfacl -m u:alice:r  /var/log/auth.log
setfacl -m u:alice:r  /etc/shadow
```
### Allowing only Alice and Bob to install packages using sudo without password prompt

###### I added the following to the sudoers file 

```
bob ALL=/usr/bin/apt-get
alice ALL=/usr/bin/apt-get
```

![image](https://user-images.githubusercontent.com/75664650/130664801-0596c225-b2b0-4292-b698-4c31e45e01ec.png)

![image](https://user-images.githubusercontent.com/75664650/130664979-8d225af9-ada1-40ca-bee8-7f0af3968a37.png)

![image](https://user-images.githubusercontent.com/75664650/130664870-9469132d-80b2-48a5-8a51-29bf384bb7d9.png)














 

















































